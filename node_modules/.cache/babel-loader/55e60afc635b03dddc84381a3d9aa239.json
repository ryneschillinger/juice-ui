{"ast":null,"code":"/*\n * Copyright 2020 Palantir Technologies, Inc. All rights reserved.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport { __assign, __decorate, __extends, __rest } from \"tslib\";\nimport classNames from \"classnames\";\nimport * as React from \"react\";\nimport { polyfill } from \"react-lifecycles-compat\";\nimport { AbstractPureComponent2, Classes, Utils } from \"../../common\";\nimport { DISPLAYNAME_PREFIX } from \"../../common/props\";\nimport { Button } from \"../button/buttons\";\nimport { Dialog } from \"./dialog\";\nimport { DialogStep } from \"./dialogStep\";\nvar PADDING_BOTTOM = 0;\nvar MIN_WIDTH = 800;\n\nvar MultistepDialog =\n/** @class */\nfunction (_super) {\n  __extends(MultistepDialog, _super);\n\n  function MultistepDialog() {\n    var _this = _super !== null && _super.apply(this, arguments) || this;\n\n    _this.state = _this.getInitialIndexFromProps(_this.props);\n\n    _this.renderDialogStep = function (step, index) {\n      var _a;\n\n      var stepNumber = index + 1;\n      var hasBeenViewed = _this.state.lastViewedIndex >= index;\n      var currentlySelected = _this.state.selectedIndex === index;\n      return React.createElement(\"div\", {\n        className: classNames(Classes.DIALOG_STEP_CONTAINER, (_a = {}, _a[Classes.ACTIVE] = currentlySelected, _a[Classes.DIALOG_STEP_VIEWED] = hasBeenViewed, _a)),\n        key: index\n      }, React.createElement(\"div\", {\n        className: Classes.DIALOG_STEP,\n        onClick: _this.handleClickDialogStep(index)\n      }, React.createElement(\"div\", {\n        className: Classes.DIALOG_STEP_ICON\n      }, stepNumber), React.createElement(\"div\", {\n        className: Classes.DIALOG_STEP_TITLE\n      }, step.props.title)));\n    };\n\n    _this.handleClickDialogStep = function (index) {\n      if (index > _this.state.lastViewedIndex) {\n        return;\n      }\n\n      return _this.getDialogStepChangeHandler(index);\n    };\n\n    return _this;\n  }\n\n  MultistepDialog.prototype.render = function () {\n    var _a = this.props,\n        showCloseButtonInFooter = _a.showCloseButtonInFooter,\n        isCloseButtonShown = _a.isCloseButtonShown,\n        otherProps = __rest(_a, [\"showCloseButtonInFooter\", \"isCloseButtonShown\"]); // Only one close button should be displayed. If the footer close button\n    // is shown, we need to ensure the dialog close button is not displayed.\n\n\n    var isCloseButtonVisible = !showCloseButtonInFooter && isCloseButtonShown;\n    return React.createElement(Dialog, __assign({\n      isCloseButtonShown: isCloseButtonVisible\n    }, otherProps, {\n      style: this.getDialogStyle()\n    }), React.createElement(\"div\", {\n      className: Classes.MULTISTEP_DIALOG_PANELS\n    }, this.renderLeftPanel(), this.maybeRenderRightPanel()));\n  };\n\n  MultistepDialog.prototype.componentDidUpdate = function (prevProps) {\n    if ((prevProps.resetOnClose || prevProps.initialStepIndex !== this.props.initialStepIndex) && !prevProps.isOpen && this.props.isOpen) {\n      this.setState(this.getInitialIndexFromProps(this.props));\n    }\n  };\n\n  MultistepDialog.prototype.getDialogStyle = function () {\n    return __assign({\n      minWidth: MIN_WIDTH,\n      paddingBottom: PADDING_BOTTOM\n    }, this.props.style);\n  };\n\n  MultistepDialog.prototype.renderLeftPanel = function () {\n    return React.createElement(\"div\", {\n      className: Classes.MULTISTEP_DIALOG_LEFT_PANEL\n    }, this.getDialogStepChildren().filter(isDialogStepElement).map(this.renderDialogStep));\n  };\n\n  MultistepDialog.prototype.maybeRenderRightPanel = function () {\n    var steps = this.getDialogStepChildren();\n\n    if (steps.length <= this.state.selectedIndex) {\n      return null;\n    }\n\n    var _a = steps[this.state.selectedIndex].props,\n        className = _a.className,\n        panel = _a.panel,\n        panelClassName = _a.panelClassName;\n    return React.createElement(\"div\", {\n      className: classNames(Classes.MULTISTEP_DIALOG_RIGHT_PANEL, className, panelClassName)\n    }, panel, this.renderFooter());\n  };\n\n  MultistepDialog.prototype.renderFooter = function () {\n    var _a = this.props,\n        closeButtonProps = _a.closeButtonProps,\n        isCloseButtonShown = _a.isCloseButtonShown,\n        showCloseButtonInFooter = _a.showCloseButtonInFooter,\n        onClose = _a.onClose;\n    var isFooterCloseButtonVisible = showCloseButtonInFooter && isCloseButtonShown;\n    var maybeCloseButton = !isFooterCloseButtonVisible ? undefined : React.createElement(Button, __assign({\n      text: \"Close\",\n      onClick: onClose\n    }, closeButtonProps));\n    return React.createElement(\"div\", {\n      className: Classes.MULTISTEP_DIALOG_FOOTER\n    }, maybeCloseButton, React.createElement(\"div\", {\n      className: Classes.DIALOG_FOOTER_ACTIONS\n    }, this.renderButtons()));\n  };\n\n  MultistepDialog.prototype.renderButtons = function () {\n    var _a, _b;\n\n    var selectedIndex = this.state.selectedIndex;\n    var steps = this.getDialogStepChildren();\n    var buttons = [];\n\n    if (this.state.selectedIndex > 0) {\n      var backButtonProps = (_a = steps[selectedIndex].props.backButtonProps) !== null && _a !== void 0 ? _a : this.props.backButtonProps;\n      buttons.push(React.createElement(Button, __assign({\n        key: \"back\",\n        onClick: this.getDialogStepChangeHandler(selectedIndex - 1),\n        text: \"Back\"\n      }, backButtonProps)));\n    }\n\n    if (selectedIndex === this.getDialogStepChildren().length - 1) {\n      buttons.push(React.createElement(Button, __assign({\n        intent: \"primary\",\n        key: \"final\",\n        text: \"Submit\"\n      }, this.props.finalButtonProps)));\n    } else {\n      var nextButtonProps = (_b = steps[selectedIndex].props.nextButtonProps) !== null && _b !== void 0 ? _b : this.props.nextButtonProps;\n      buttons.push(React.createElement(Button, __assign({\n        intent: \"primary\",\n        key: \"next\",\n        onClick: this.getDialogStepChangeHandler(selectedIndex + 1),\n        text: \"Next\"\n      }, nextButtonProps)));\n    }\n\n    return buttons;\n  };\n\n  MultistepDialog.prototype.getDialogStepChangeHandler = function (index) {\n    var _this = this;\n\n    return function (event) {\n      if (_this.props.onChange !== undefined) {\n        var steps = _this.getDialogStepChildren();\n\n        var prevStepId = steps[_this.state.selectedIndex].props.id;\n        var newStepId = steps[index].props.id;\n\n        _this.props.onChange(newStepId, prevStepId, event);\n      }\n\n      _this.setState({\n        lastViewedIndex: Math.max(_this.state.lastViewedIndex, index),\n        selectedIndex: index\n      });\n    };\n  };\n  /** Filters children to only `<DialogStep>`s */\n\n\n  MultistepDialog.prototype.getDialogStepChildren = function (props) {\n    if (props === void 0) {\n      props = this.props;\n    }\n\n    return React.Children.toArray(props.children).filter(isDialogStepElement);\n  };\n\n  MultistepDialog.prototype.getInitialIndexFromProps = function (props) {\n    if (props.initialStepIndex !== undefined) {\n      var boundedInitialIndex = Math.max(0, Math.min(props.initialStepIndex, this.getDialogStepChildren(props).length - 1));\n      return {\n        lastViewedIndex: boundedInitialIndex,\n        selectedIndex: boundedInitialIndex\n      };\n    } else {\n      return {\n        lastViewedIndex: 0,\n        selectedIndex: 0\n      };\n    }\n  };\n\n  MultistepDialog.displayName = DISPLAYNAME_PREFIX + \".MultistepDialog\";\n  MultistepDialog.defaultProps = {\n    canOutsideClickClose: true,\n    isOpen: false,\n    resetOnClose: true,\n    showCloseButtonInFooter: false\n  };\n  MultistepDialog = __decorate([polyfill], MultistepDialog);\n  return MultistepDialog;\n}(AbstractPureComponent2);\n\nexport { MultistepDialog };\n\nfunction isDialogStepElement(child) {\n  return Utils.isElementOfType(child, DialogStep);\n}","map":null,"metadata":{},"sourceType":"module"}